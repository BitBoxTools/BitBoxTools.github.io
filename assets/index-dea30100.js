import{r as n,x as e,bb as A,aY as S,aV as v,bK as x,bL as Y,F as g,bM as E,bN as w,D as M,bO as C,s as k,S as b,B as F,bJ as L,bP as V,bQ as I}from"./index-e96838bf.js";import{g as z}from"./getEthPrice-d4038215.js";const Z=r=>JSON.parse(localStorage.getItem(r)),R=(r,a)=>{let t=x(r).startOf("day");const s=x(a).startOf("day");let c=[];for(;t.isSameOrBefore(s);)c.push({date:t.format("YYYY-MM-DD"),value:0}),t=t.add(1,"days");return c},B=({transactions:r,ethPrice:a})=>{const t=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;const s=r.sort((d,f)=>x(d.receivedAt).isAfter(f.receivedAt)?1:-1),c=s[0].receivedAt,o=s[s.length-1].receivedAt,l=R(c,o);let i={};r.forEach(d=>{const f=x(d.receivedAt).format("YYYY-MM-DD");i[f]={date:f,value:parseInt(d.fee,16)/10**18*a}});let u=l.map(d=>i[d.date]||d);return t.current&&new Y(t.current,{data:u,xField:"date",yField:"value",slider:{start:0,end:1,formatter:f=>x(f).format("YYYY-MM-DD")}}).render(),()=>{t.current&&(t.current.innerHTML="")}},[r]),e.jsx(g,{title:"每日Gas消耗统计(U)",children:e.jsx("div",{ref:t,style:{height:300}})})},O=({transactions:r,ethPrice:a})=>{const t=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let s=[],c=0;return r.forEach(o=>{c+=parseInt(o.fee,16)/10**18*a,s.push({date:x(o.receivedAt).format("YYYY-MM-DD"),value:c})}),t.current&&new E(t.current,{data:s,xField:"date",yField:"value",smooth:!0,isStack:!0,slider:{start:0,end:1,formatter:l=>x(l).format("YYYY-MM-DD")},label:{formatter:l=>l.value.toFixed(2)}}).render(),()=>{t.current&&(t.current.innerHTML="")}},[r]),e.jsx(g,{title:"累计Gas消耗统计(U)",children:e.jsx("div",{ref:t,style:{height:300}})})},H=({transactions:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;const t=r.sort((u,d)=>x(u.receivedAt).isAfter(d.receivedAt)?1:-1),s=t[0].receivedAt,c=t[t.length-1].receivedAt,o=R(s,c);let l={};r.forEach(u=>{const d=x(u.receivedAt).format("YYYY-MM-DD");l[d]?l[d].value+=1:l[d]={date:d,value:1}});let i=o.map(u=>l[u.date]||u);return a.current&&new Y(a.current,{data:i,xField:"date",yField:"value",slider:{start:0,end:1,formatter:d=>x(d).format("YYYY-MM-DD")}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"每日交易Tx",children:e.jsx("div",{ref:a,style:{height:300}})})},N=({transaction:r})=>{const a=r.transfers.sort((t,s)=>parseInt(s.amount)*10**-s.token.decimals*s.token.price-parseInt(t.amount)*10**-t.token.decimals*t.token.price);return a.length===0?0:parseInt(a[0].amount)*10**-a[0].token.decimals*a[0].token.price},P=({transactions:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let t={},s=0;r.forEach(o=>{const l=x(o.receivedAt).format("YYYY-MM-DD"),i=N({transaction:o});s+=i,t[l]={date:l,value:s}});let c=Object.values(t);return a.current&&new E(a.current,{data:c,xField:"date",yField:"value",smooth:!0,isStack:!0,slider:{start:0,end:1,formatter:l=>x(l).format("YYYY-MM-DD")},label:{formatter:l=>l.value.toFixed(2)}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"累计交易量(U)",children:e.jsx("div",{ref:a,style:{height:300}})})},_=()=>{const[r,a]=n.useState({}),[t,s]=n.useState(""),[c,o]=n.useState(0);return n.useEffect(()=>{z().then(i=>{o(Number(i))}),(Z("zkSync_transactions")||[]).forEach(i=>{a(u=>({...u,[i.address]:i.transactions}))})},[]),e.jsxs("div",{children:[e.jsx(A,{defaultValue:"选择地址展示数据.",style:{width:"100%",marginTop:"20px"},onChange:l=>{s(l)},options:Object.keys(r).map(l=>({label:l,value:l}))}),e.jsxs(S,{gutter:16,style:{marginTop:20},children:[e.jsx(v,{xs:24,md:12,children:t&&e.jsx(B,{transactions:r[t],ethPrice:c})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx(O,{transactions:r[t],ethPrice:c})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx(H,{transactions:r[t]})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx(P,{transactions:r[t]})})]})]})},$=({data:r,title:a})=>{const t=n.useRef(null);return n.useEffect(()=>(t.current&&new C(t.current,{data:r,angleField:"value",colorField:"type",radius:.8,label:{type:"inner",offset:"-30%",content:"{value}",style:{textAlign:"center",fontSize:14}},interactions:[{type:"element-active"}],legend:{layout:"horizontal",position:"bottom"}}).render(),()=>{t.current&&(t.current.innerHTML="")}),[r]),e.jsx(g,{title:a,children:e.jsx("div",{ref:t,style:{height:"300px"}})})},G=()=>{const r=[{key:"lastHourlyTxs",title:"过去1小数Tx"},{key:"currentDayTxs",title:"当天Tx"},{key:"prevDayTxs",title:"前一天Tx"},{key:"dayBeforeLastTxs",title:"前两天Tx"},{key:"weeklyTxs",title:"一周Tx"},{key:"monthlyTxs",title:"一月Tx"}],[a,t]=n.useState([]),[s,c]=n.useState(!1),[o,l]=n.useState(null);return n.useEffect(()=>{const i="https://bridges.llama.fi/bridge/26";(async()=>{c(!0);try{const f=(await k.get(i)).data.chainBreakdown["zkSync Era"];r.forEach(y=>{t(m=>[...m,{title:y.title,value:[{type:"L2 Withdrawal To L1",value:f[y.key].deposits},{type:"L1 Deposit To L2",value:f[y.key].withdrawals}]}])}),l(null)}catch(d){console.error("Error fetching data: ",d),l("Error fetching data.")}c(!1)})()},[]),o?e.jsx(w,{message:"Error",description:o,type:"error",showIcon:!0}):e.jsx("div",{children:e.jsx(M,{spinning:s,children:e.jsx(S,{gutter:[16,16],children:a.map((i,u)=>e.jsx(v,{xs:24,sm:12,md:6,children:e.jsx($,{data:i.value,title:i.title})},u))})})})},{Text:D}=L,U=({data:r,change_7d:a,change_1d:t,onRefresh:s,isLoading:c})=>{const o=n.useRef(null);return n.useEffect(()=>(o.current&&new Y(o.current,{data:r,xField:"date",yField:"volume",slider:{start:0,end:1}}).render(),()=>{o.current&&(o.current.innerHTML="")}),[r]),e.jsx(M,{spinning:c,size:"large",children:e.jsx(g,{title:"Vol(M)",extra:e.jsxs(b,{children:[e.jsx(F,{onClick:s,loading:c,children:"Refresh"}),e.jsx(D,{type:"secondary",children:"1d: "}),e.jsxs(D,{type:t<0?"danger":"success",children:[t,"%"]}),e.jsx(D,{type:"secondary",children:"7d: "}),e.jsxs(D,{type:a<0?"danger":"success",children:[a,"%"]})]}),children:e.jsx("div",{ref:o,style:{height:500}})})})},J=()=>{const[r,a]=n.useState([]),[t,s]=n.useState(0),[c,o]=n.useState(0),[l,i]=n.useState(!1),[u,d]=n.useState(null),f="https://api.llama.fi/overview/dexs/zkSync%20Era?excludeTotalDataChart=false&excludeTotalDataChartBreakdown=true&dataType=dailyVolume",y=async()=>{i(!0);try{const h=await k.get(f);let j=[];for(let p=0;p<h.data.totalDataChart.length;p++)j.push({date:new Date(Number(h.data.totalDataChart[p][0])*1e3).toLocaleDateString(),volume:h.data.totalDataChart[p][1]/1e6});a(j),s(h.data.change_1d),o(h.data.change_7d)}catch{d("Error fetching data.")}i(!1)},m=()=>{y()};return n.useEffect(()=>{y()},[]),u?e.jsx(w,{message:"Error",description:u,type:"error",showIcon:!0}):e.jsx(e.Fragment,{children:r.length>0&&e.jsx(U,{data:r,change_1d:t,change_7d:c,onRefresh:m,isLoading:l})})},{Text:T}=L,K=async()=>{const r="https://api.llama.fi/v2/historicalChainTvl/zkSync%20Era";return(await k.get(r)).data},Q=({data:r,nowTvl:a,change24h:t,onRefresh:s})=>{const c=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let o=[];r.forEach(i=>{o.push({date:new Date(i.date*1e3).toLocaleDateString(),tvl:i.tvl/1e6})});const l=Math.max(...o.map(i=>i.tvl));return c.current&&new E(c.current,{data:o,xField:"date",yField:"tvl",smooth:!0,isStack:!0,label:{content:u=>`${u.tvl.toFixed(0)}`},slider:{start:0,end:1,formatter:u=>x(u).format("YYYY-MM-DD")},meta:{tvl:{alias:"TVL(M)",min:0,max:l*1.1}}}).render(),()=>{c.current&&(c.current.innerHTML="")}},[r]),e.jsx(g,{title:"TVL(M)",bordered:!0,extra:e.jsxs(b,{children:[e.jsx(T,{type:"secondary",children:"Now "}),e.jsxs(T,{children:[Number(a/1e6).toFixed(2),"M"]}),e.jsx(T,{type:"secondary",children:"24h "}),e.jsx(T,{type:t.includes("-")?"danger":"success",children:t}),e.jsx(F,{type:"primary",onClick:s,children:"Refresh"})]}),children:e.jsx("div",{ref:c,style:{height:500}})})},W=({data:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length!==0)return a.current&&new V(a.current,{data:r,xField:"tvl",yField:"name",yAxis:{label:{formatter:s=>`${s}`}},label:{position:"right",formatter:s=>`${s.tvl.toFixed(2)}`},meta:{tvl:{alias:"TVL(M)",max:Math.max(...r.map(s=>s.tvl))*1.1}}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"Top 30 TVL(M)",children:e.jsx("div",{ref:a,style:{height:500}})})},X=async()=>{const r="https://api.llama.fi/protocols",a=await k.get(r);let t=[];return a.data.forEach(s=>{s.chains.includes("zkSync Era")&&s.category!=="CEX"&&t.push({name:s.name,tvl:s.chainTvls["zkSync Era"]/1e6})}),t.sort((s,c)=>c.tvl-s.tvl),t=t.slice(0,30),t},q=()=>{const[r,a]=n.useState([]),[t,s]=n.useState(null),[c,o]=n.useState(null),[l,i]=n.useState([]),[u,d]=n.useState(!1),[f,y]=n.useState(null),m=async()=>{d(!0);try{const h=await K();a(h);const j=(h[h.length-1].tvl-h[h.length-2].tvl)/h[h.length-2].tvl*100;s(`${j.toFixed(2)}%`),o(h[h.length-1].tvl);const p=await X();i(p)}catch(h){console.error("Failed to fetch data: ",h),y("Failed to fetch data.")}d(!1)};return n.useEffect(()=>{m()},[]),f?e.jsxs("div",{children:["Error: ",f]}):e.jsx("div",{children:e.jsx(M,{spinning:u,children:e.jsxs(S,{gutter:16,style:{marginTop:20},children:[e.jsx(v,{xs:24,md:12,children:r.length!==0&&e.jsx(Q,{data:r,nowTvl:c,change24h:t,onRefresh:m})}),e.jsx(v,{xs:24,md:12,children:l.length!==0&&e.jsx(W,{data:l})})]})})})},re=()=>{const r=[{label:"个人地址详情",key:"ZksyncMyAddress",children:e.jsx(_,{})},{label:"zkSync Tvl",key:"ZksyncTvl",children:e.jsx(q,{})},{label:"zkSync Bridge",key:"ZksyncBridge",children:e.jsx(G,{})},{label:"zkSync Vol",key:"ZksyncVol",children:e.jsx(J,{})}];return e.jsx(e.Fragment,{children:e.jsx(I,{defaultActiveKey:"ZksyncTvl",centered:!0,items:r})})};export{re as default};
