import{r as j,j as t}from"./index-63ac071b.js";import{U as K,S as H,D as R,n as T,e as Y}from"./save_excel-76321d0b.js";import{a as v,C as G}from"./axios-71a4378e.js";import{C as Q,c as X}from"./index-8607a08e.js";import{F as b,M as N,c as Z,P as L,d as A,T as ee}from"./index-db3395e6.js";import{I as F,S as g,P as te}from"./index-ea042be6.js";import{a1 as w,a3 as se}from"./EditOutlined-d3b23394.js";import{L as ae}from"./index-fb9c3643.js";import{S as ne}from"./index-715c0ea4.js";import{m as re}from"./index-2bed38bc.js";const M={ethereum:"ETH",dai:"DAI","usd-coin":"USDC",tether:"USDT","wrapped-bitcoin":"WBTC"};async function oe(){const n=`https://api.coingecko.com/api/v3/simple/price?ids=${Object.keys(M).join(",")}&vs_currencies=usd`;try{const r=await v.get(n),i={};for(const s in r.data){const a=M[s];a&&(i[a]=r.data[s].usd)}return i}catch(r){throw new Error("Error fetching token prices:",r.message)}}async function ie(c){let n=1,r=[];const i=await oe();for(;;){const s=`https://voyager.online/api/contract/${c}/transfers?ps=50&p=${n}`,a=await v.get(s),{items:d,lastPage:f}=a.data;if(d.forEach(h=>{const{tx_hash:p,transfer_from:k,transfer_to:x,transfer_value:S,token_symbol:I,token_type:E,token_decimals:$}=h,O={tx_hash:p,transfer_from:k,transfer_to:x,transfer_value:S,token_symbol:I,token_type:E,token_decimals:$,total_value:i.hasOwnProperty(I)?S*i[I]:0};r.push(O)}),f===n)break;n++}return r}async function le(c){let n=[],r=1;for(;;){const s=`https://voyager.online/api/txns?to=${c}&ps=50&p=${r}&type=null`,a=await v.get(s),{items:d,lastPage:f}=a.data;if(d.forEach(h=>{const{actual_fee:p,hash:k,timestamp:x}=h,S={actual_fee:Number(p)/10**18,hash:k,timestamp:x,transfer:[]};n.push(S)}),f===r)break;r++}return(await ie(c)).forEach(s=>{n.forEach(a=>{a.hash===s.tx_hash&&a.transfer.push(s)})}),n}const ce=c=>{const n=new Date(c)*1e3,r=(new Date().getTime()-new Date(n).getTime())/1e3;if(r<60)return Math.round(r)+" 秒前";const i=r/60;if(i<60)return Math.round(i)+" 分前";const s=i/60;if(s<24)return Math.round(s)+" 时前";const a=s/24;return Math.round(a)+" 天前"},de=c=>{const n=c.getFullYear(),r=new Date(n,0,1),i=(c.getDay()+6)%7,s=Math.floor((c.getTime()-r.getTime())/864e5),a=Math.floor((s+r.getDay()-i)/7);return`${n}-${a}`},ue=(c,n)=>{let r=0;const i=new Set,s=new Set,a=new Set;return n.forEach(d=>{const f=new Date(d.timestamp*1e3);r+=d.actual_fee;const h=f.getFullYear(),p=f.getMonth();console.log(`year: ${h}, month: ${p}`);const k=f.getDate(),x=de(f);i.add(`${h} -${p} -${k}`),s.add(`${h} -${x}`),a.add(`${h} -${p}`)}),{fee:r.toFixed(3),days:i.size,weeks:s.size,months:a.size}},me=async(c,n)=>{const{fee:r,days:i,weeks:s,months:a}=ue(c,n),d=n[0],f=ce(d.timestamp)||"无交易";return{fee:r,days:i,weeks:s,months:a,lastTransactionTimeAgo:f}};async function ge(){const n=`https://api.coingecko.com/api/v3/simple/price?ids=${["ethereum","dai","tether","usd-coin","wrapped-bitcoin"].join(",")}&vs_currencies=usd`;let r={},i={ethereum:{sym:0,dec:18},dai:{sym:1,dec:18},"usd-coin":{sym:2,dec:6},tether:{sym:3,dec:6},"wrapped-bitcoin":{sym:4,dec:8}};try{const s=await v.get(n);for(const a in s.data)r[i[a].sym]=s.data[a].usd/10**i[a].dec;return r}catch(s){return console.error("Error fetching token prices:",s.message),null}}async function he(c){try{let n=0,r=0,i=0,s=0,a=1,d=await ge(),f=[];for(;;){const h=await v.get(`https://voyager.online/api/contract/${c}/bridgeTransactions?ps=50&p=${a}`);if(f=[...f,...h.data.items],h.data.lastPage===a||h.data.lastPage===0||h.data.items.length===0)break;a++}return f.forEach(h=>{const{token_id:p,amount:k,type:x}=h;x===0&&(n++,i+=k*d[p]),x===2&&(r++,s+=k*d[p])}),{l1_l2:n,l2_l1:r,l1_l2_amount:Number(i.toFixed(2)),l2_l1_amount:Number(s.toFixed(2))}}catch{return{l1_l2:"-",l2_l1:"-",l1_l2_amount:"-",l2_l1_amount:"-"}}}async function pe(c){try{const n=await v.get(`https://voyager.online/api/contract/${c}`),{classAlias:r,nonce:i}=n.data;return{classAlias:r==="BraavosProxy"?"Braavos":"Argent",nonce:parseInt(i,16)}}catch{return{classAlias:"-",nonce:"-"}}}async function ye(c){try{const n=await v.get(`https://voyager.online/api/contract/${c}/balances`);let r={},i=0;for(const s in n.data){const a=n.data[s].usd.replace("$","");r[n.data[s].symbol]=parseFloat(n.data[s].amount).toFixed(3),i+=Number(a).toFixed(3)}return{...r}}catch{return{ETH:"-",DAI:"-",USDC:"-",USDT:"-",WBTC:"-"}}}const fe=c=>{let n=0;return c.forEach(r=>{const i=r.transfer.sort((a,d)=>parseInt(d.total_value)-parseInt(a.total_value));if(i.length===0)return;const s=parseFloat(i[0].total_value);n+=s}),{volume:n.toFixed(3)}},C=async c=>{const n=await le(c),r=await me(c,n),i=await he(c),s=await pe(c),a=await ye(c),d=fe(n);return{activity:r,bridge:i,account:s,tokenBalance:a,volume:d}};const{TextArea:ke}=F,{Content:xe}=ae,Ee=()=>{const[c,n]=j.useState(!1),[r,i]=j.useState(!1),[s,a]=j.useState([]),[d]=b.useForm(),[f,h]=j.useState(!1),[p,k]=j.useState([]),[x,S]=j.useState(!1),[I]=b.useForm();let E=s.length;j.useEffect(()=>{S(!0);const e=localStorage.getItem("stark_addresses");setTimeout(()=>{S(!1)},500),e&&a(JSON.parse(e))},[]);const $=[{title:"#",key:"index",align:"center",render:(e,o,l)=>l+1},{title:"备注",dataIndex:"name",key:"name",align:"center",className:"name",render:(e,o)=>o.key===W?t.jsx(F,{placeholder:"请输入备注",defaultValue:e,onPressEnter:m=>{o.name=m.target.value,a([...s]),localStorage.setItem("stark_addresses",JSON.stringify(s)),B(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{color:"blue",children:e}),t.jsx(w,{shape:"circle",icon:t.jsx(se,{}),size:"small",onClick:()=>B(o.key)})]})},{title:"钱包地址",dataIndex:"address",key:"address",align:"center",className:"address",render:(e,o)=>{const l=()=>{X(e),re.success("地址已复制")};return e?t.jsxs(t.Fragment,{children:[e.slice(0,4),"...",e.slice(-4),t.jsx(w,{type:"text",icon:t.jsx(Q,{}),onClick:l,style:{marginLeft:8}})]}):t.jsx(g,{})}},{title:"Type",dataIndex:["account","classAlias"],key:"classAlias",align:"center",render:(e,o)=>e||t.jsx(g,{})},{title:"StarkWare",className:"zksync2",children:[{title:"ETH",dataIndex:["tokenBalance","ETH"],key:"stark_eth_balance",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"USDC",dataIndex:["tokenBalance","USDC"],key:"stark_usdc_balance",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"USDT",dataIndex:["tokenBalance","USDT"],key:"stark_usdt_balance",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"DAI",dataIndex:["tokenBalance","DAI"],key:"stark_dai_balance",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"WBTC",dataIndex:["tokenBalance","WBTC"],key:"stark_wbtc_balance",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"Tx",dataIndex:["account","nonce"],key:"stark_tx_amount",align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"最后交易",dataIndex:["activity","lastTransactionTimeAgo"],key:"stark_latest_tx",align:"center",render:(e,o)=>e||e===0?t.jsx("a",{href:`https://voyager.online/contract/${o.address}`,target:"_blank",children:e}):t.jsx(g,{})},{title:"官方桥Tx",className:"stark_cross_tx",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})}]},{title:"官方桥金额(U)",className:"stark_cross_amount",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2_amount"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1_amount"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})}]},{title:"活跃统计",className:"stark_activity",children:[{title:"天",dataIndex:["activity","days"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"周",dataIndex:["activity","weeks"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"月",dataIndex:["activity","months"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"金额(U)",dataIndex:["volume","volume"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})},{title:"fee(E)",dataIndex:["activity","fee"],align:"center",render:(e,o)=>e||e===0?e:t.jsx(g,{})}]},{title:"操作",key:"action",align:"center",render:(e,o)=>t.jsx(ne,{size:"small",children:t.jsx(L,{title:"确认删除？",onConfirm:()=>P(o.key),children:t.jsx(w,{icon:t.jsx(A,{})})})})}]}],O=async()=>{try{const e=await I.validateFields();if(e.address.length!==66&&e.address.length!==64){T.error({message:"错误",description:"请输入正确的stark地址(64位)"},2);return}e.address.startsWith("0x")||(e.address="0x"+e.address),n(!1);const o=s.findIndex(l=>l.address===e.address);if(o!==-1)a(s.map((l,m)=>m===o?{...l,name:e.name}:l)),C(e.address).then(l=>{a(m=>{const y=[...m];return y[o]={...y[o],...l},localStorage.setItem("stark_addresses",JSON.stringify(y)),y})});else{const l={key:s.length.toString(),name:e.name,address:e.address};a(m=>[...m,l]),C(e.address).then(m=>{a(y=>{const u=[...y];return u[u.length-1]={...u[u.length-1],...m},localStorage.setItem("stark_addresses",JSON.stringify(u)),u})})}}catch(e){T.error({message:"错误",description:e.message},2)}finally{I.resetFields()}},P=e=>{a(s.filter(o=>o.key!==e)),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(o=>o.key!==e)))},z=async()=>{try{const o=(await d.validateFields()).addresses.split(`
`);for(let l of o){if(l=l.trim(),l.length!==66&&l.length!==64){T.error({message:"错误",description:"请输入正确的stark地址(64位)"});continue}l.startsWith("0x")||(l="0x"+l);const m=s.findIndex(y=>y.address===l);if(m!==-1){const y=await C(l);a(u=>{const _=[...u];return _[m]={..._[m],...y},localStorage.setItem("stark_addresses",JSON.stringify(_)),_})}else{const y={key:E.toString(),address:l};E++,a(_=>[..._,y]);const u=await C(l);a(_=>{const D=[..._];return D[D.length-1]={...D[D.length-1],...u},localStorage.setItem("stark_addresses",JSON.stringify(D)),D})}}i(!1)}catch(e){T.error({message:"错误",description:e.message})}finally{d.resetFields(),k([])}},U=async()=>{if(!p.length){T.error({message:"错误",description:"请先选择要刷新的地址"},2);return}h(!0);try{let e=[];for(let o of p){const l=s.findIndex(m=>m.key===o);l!==-1&&(a(m=>{const y=[...m];for(let u in y[l])u!=="address"&&u!=="name"&&u!=="key"&&(y[l][u]=null);return y}),e.push(C(s[l].address).then(m=>{a(y=>{const u=[...y];return u[l]={...u[l],...m},localStorage.setItem("stark_addresses",JSON.stringify(u)),u})})))}await Promise.all(e)}catch(e){T.error({message:"错误",description:e.message},2)}finally{h(!1),k([])}},J=()=>{if(!p.length){T.error({message:"错误",description:"请先选择要删除的地址"},2);return}a(s.filter(e=>!p.includes(e.key))),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(e=>!p.includes(e.key)))),k([])},V=()=>{Y(s,"starkInfo")},[W,B]=j.useState(null),q={selectedRowKeys:p,onChange:e=>{k(e)}};return t.jsx("div",{children:t.jsxs(xe,{children:[t.jsx(N,{title:"批量添加地址",open:r,onOk:z,onCancel:()=>{i(!1),d.resetFields()},okText:"添加地址",cancelText:"取消",width:800,children:t.jsx(b,{form:d,layout:"vertical",children:t.jsx(b.Item,{label:"地址",name:"addresses",rules:[{required:!0}],children:t.jsx(ke,{placeholder:"请输入地址，每行一个",style:{width:"100%",height:"300px",resize:"none"}})})})}),t.jsx(N,{title:"添加地址",open:c,onOk:O,onCancel:()=>n(!1),okText:"添加地址",cancelText:"取消",width:800,children:t.jsxs(b,{form:I,layout:"vertical",children:[t.jsx(b.Item,{label:"地址",name:"address",rules:[{required:!0}],children:t.jsx(F,{placeholder:"请输入地址",style:{width:"100%"}})}),t.jsx(b.Item,{label:"备注",name:"name",children:t.jsx(F,{placeholder:"请输入备注",style:{width:"100%"}})})]})}),t.jsx(g,{spinning:x,children:t.jsx(Z,{rowSelection:q,dataSource:s,pagination:!1,bordered:!0,style:{marginBottom:"20px"},size:"small",columns:$})}),t.jsx(G,{children:t.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[t.jsx(w,{type:"primary",onClick:()=>{n(!0)},size:"large",style:{width:"20%"},icon:t.jsx(te,{}),children:"添加地址"}),t.jsx(w,{type:"primary",onClick:()=>{i(!0)},size:"large",style:{width:"20%"},icon:t.jsx(K,{}),children:"批量添加地址"}),t.jsx(w,{type:"primary",onClick:U,loading:f,size:"large",style:{width:"20%"},icon:t.jsx(H,{}),children:"刷新选中地址"}),t.jsx(L,{title:"确认删除"+p.length+"个地址？",onConfirm:J,children:t.jsx(w,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:t.jsx(A,{}),children:"删除选中地址"})}),t.jsx(w,{type:"primary",icon:t.jsx(R,{}),size:"large",style:{width:"8%"},onClick:V})]})})]})})};export{Ee as default};
