import{r as n,x as e,aU as S,aR as v,bM as x,bN as Y,D as g,bO as E,bP as w,z as M,bQ as z,s as k,S as b,B as A,bL as F,bR as V,bS as Z}from"./index-d1b02a05.js";import{g as I}from"./getEthPrice-29492c9e.js";import{i as R,d as C,a as B,g as H}from"./main-99ba1b8b.js";import{a as O}from"./index-6411d5e4.js";const L=(r,a)=>{let t=x(r).startOf("day");const s=x(a).startOf("day");let l=[];for(;t.isSameOrBefore(s);)l.push({date:t.format("YYYY-MM-DD"),value:0}),t=t.add(1,"days");return l},N=({transactions:r,ethPrice:a})=>{const t=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;const s=r.sort((d,f)=>x(d.receivedAt).isAfter(f.receivedAt)?1:-1),l=s[0].receivedAt,i=s[s.length-1].receivedAt,c=L(l,i);let u={};r.forEach(d=>{const f=x(d.receivedAt).format("YYYY-MM-DD");u[f]={date:f,value:parseInt(d.fee,16)/10**18*a}});let o=c.map(d=>u[d.date]||d);return t.current&&new Y(t.current,{data:o,xField:"date",yField:"value",slider:{start:0,end:1,formatter:f=>x(f).format("YYYY-MM-DD")}}).render(),()=>{t.current&&(t.current.innerHTML="")}},[r]),e.jsx(g,{title:"每日Gas消耗统计(U)",children:e.jsx("div",{ref:t,style:{height:300}})})},P=({transactions:r,ethPrice:a})=>{const t=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let s=[],l=0;return r.forEach(i=>{l+=parseInt(i.fee,16)/10**18*a,s.push({date:x(i.receivedAt).format("YYYY-MM-DD"),value:l})}),t.current&&new E(t.current,{data:s,xField:"date",yField:"value",smooth:!0,isStack:!0,slider:{start:0,end:1,formatter:c=>x(c).format("YYYY-MM-DD")},label:{formatter:c=>c.value.toFixed(2)}}).render(),()=>{t.current&&(t.current.innerHTML="")}},[r]),e.jsx(g,{title:"累计Gas消耗统计(U)",children:e.jsx("div",{ref:t,style:{height:300}})})},$=({transactions:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;const t=r.sort((o,d)=>x(o.receivedAt).isAfter(d.receivedAt)?1:-1),s=t[0].receivedAt,l=t[t.length-1].receivedAt,i=L(s,l);let c={};r.forEach(o=>{const d=x(o.receivedAt).format("YYYY-MM-DD");c[d]?c[d].value+=1:c[d]={date:d,value:1}});let u=i.map(o=>c[o.date]||o);return a.current&&new Y(a.current,{data:u,xField:"date",yField:"value",slider:{start:0,end:1,formatter:d=>x(d).format("YYYY-MM-DD")}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"每日交易Tx",children:e.jsx("div",{ref:a,style:{height:300}})})},U=({transaction:r})=>{const a=r.transfers.sort((t,s)=>parseInt(s.amount)*10**-s.token.decimals*s.token.price-parseInt(t.amount)*10**-t.token.decimals*t.token.price);return a.length===0?0:parseInt(a[0].amount)*10**-a[0].token.decimals*a[0].token.price},_=({transactions:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let t={},s=0;r.forEach(i=>{const c=x(i.receivedAt).format("YYYY-MM-DD"),u=U({transaction:i});s+=u,t[c]={date:c,value:s}});let l=Object.values(t);return a.current&&new E(a.current,{data:l,xField:"date",yField:"value",smooth:!0,isStack:!0,slider:{start:0,end:1,formatter:c=>x(c).format("YYYY-MM-DD")},label:{formatter:c=>c.value.toFixed(2)}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"累计交易量(U)",children:e.jsx("div",{ref:a,style:{height:300}})})},G=async()=>(await R(C),await B("zkTransactions")||[]),K=async r=>{await R(C);const a=await H("zkTransactions",r);return(a.data?JSON.parse(a.data):[])||[]},J=()=>{const[r,a]=n.useState([]),[t,s]=n.useState(""),[l,i]=n.useState([]),[c,u]=n.useState(0);return n.useEffect(()=>{I().then(o=>{u(Number(o))})},[]),n.useEffect(()=>{G().then(o=>{a(o)})},[]),e.jsxs("div",{children:[e.jsx(O,{defaultValue:"选择地址展示数据.",style:{width:"100%",marginTop:"20px"},onChange:o=>{s(o),K(o).then(d=>{i(d)})},notFoundContent:"暂无数据,请先刷新您的zkSync获取数据",options:r.map(o=>({value:o,label:o}))}),e.jsxs(S,{gutter:16,style:{marginTop:20},children:[e.jsx(v,{xs:24,md:12,children:t&&e.jsx(N,{transactions:l,ethPrice:c})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx(P,{transactions:l,ethPrice:c})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx($,{transactions:l})}),e.jsx(v,{xs:24,md:12,children:t&&e.jsx(_,{transactions:l})})]})]})},Q=({data:r,title:a})=>{const t=n.useRef(null);return n.useEffect(()=>(t.current&&new z(t.current,{data:r,angleField:"value",colorField:"type",radius:.8,label:{type:"inner",offset:"-30%",content:"{value}",style:{textAlign:"center",fontSize:14}},interactions:[{type:"element-active"}],legend:{layout:"horizontal",position:"bottom"}}).render(),()=>{t.current&&(t.current.innerHTML="")}),[r]),e.jsx(g,{title:a,children:e.jsx("div",{ref:t,style:{height:"300px"}})})},W=()=>{const r=[{key:"lastHourlyTxs",title:"过去1小数Tx"},{key:"currentDayTxs",title:"当天Tx"},{key:"prevDayTxs",title:"前一天Tx"},{key:"dayBeforeLastTxs",title:"前两天Tx"},{key:"weeklyTxs",title:"一周Tx"},{key:"monthlyTxs",title:"一月Tx"}],[a,t]=n.useState([]),[s,l]=n.useState(!1),[i,c]=n.useState(null);return n.useEffect(()=>{const u="https://bridges.llama.fi/bridge/26";(async()=>{l(!0);try{const f=(await k.get(u)).data.chainBreakdown["zkSync Era"];r.forEach(y=>{t(m=>[...m,{title:y.title,value:[{type:"L2 Withdrawal To L1",value:f[y.key].deposits},{type:"L1 Deposit To L2",value:f[y.key].withdrawals}]}])}),c(null)}catch(d){console.error("Error fetching data: ",d),c("Error fetching data.")}l(!1)})()},[]),i?e.jsx(w,{message:"Error",description:i,type:"error",showIcon:!0}):e.jsx("div",{children:e.jsx(M,{spinning:s,children:e.jsx(S,{gutter:[16,16],children:a.map((u,o)=>e.jsx(v,{xs:24,sm:12,md:6,children:e.jsx(Q,{data:u.value,title:u.title})},o))})})})},{Text:j}=F,X=({data:r,change_7d:a,change_1d:t,onRefresh:s,isLoading:l})=>{const i=n.useRef(null);return n.useEffect(()=>(i.current&&new Y(i.current,{data:r,xField:"date",yField:"volume",slider:{start:0,end:1}}).render(),()=>{i.current&&(i.current.innerHTML="")}),[r]),e.jsx(M,{spinning:l,size:"large",children:e.jsx(g,{title:"Vol(M)",extra:e.jsxs(b,{children:[e.jsx(A,{onClick:s,loading:l,children:"Refresh"}),e.jsx(j,{type:"secondary",children:"1d: "}),e.jsxs(j,{type:t<0?"danger":"success",children:[t,"%"]}),e.jsx(j,{type:"secondary",children:"7d: "}),e.jsxs(j,{type:a<0?"danger":"success",children:[a,"%"]})]}),children:e.jsx("div",{ref:i,style:{height:500}})})})},q=()=>{const[r,a]=n.useState([]),[t,s]=n.useState(0),[l,i]=n.useState(0),[c,u]=n.useState(!1),[o,d]=n.useState(null),f="https://api.llama.fi/overview/dexs/zkSync%20Era?excludeTotalDataChart=false&excludeTotalDataChartBreakdown=true&dataType=dailyVolume",y=async()=>{u(!0);try{const h=await k.get(f);let D=[];for(let p=0;p<h.data.totalDataChart.length;p++)D.push({date:new Date(Number(h.data.totalDataChart[p][0])*1e3).toLocaleDateString(),volume:h.data.totalDataChart[p][1]/1e6});a(D),s(h.data.change_1d),i(h.data.change_7d)}catch{d("Error fetching data.")}u(!1)},m=()=>{y()};return n.useEffect(()=>{y()},[]),o?e.jsx(w,{message:"Error",description:o,type:"error",showIcon:!0}):e.jsx(e.Fragment,{children:r.length>0&&e.jsx(X,{data:r,change_1d:t,change_7d:l,onRefresh:m,isLoading:c})})},{Text:T}=F,ee=async()=>{const r="https://api.llama.fi/v2/historicalChainTvl/zkSync%20Era";return(await k.get(r)).data},te=({data:r,nowTvl:a,change24h:t,onRefresh:s})=>{const l=n.useRef(null);return n.useEffect(()=>{if(r.length===0)return;let i=[];r.forEach(u=>{i.push({date:new Date(u.date*1e3).toLocaleDateString(),tvl:u.tvl/1e6})});const c=Math.max(...i.map(u=>u.tvl));return l.current&&new E(l.current,{data:i,xField:"date",yField:"tvl",smooth:!0,isStack:!0,label:{content:o=>`${o.tvl.toFixed(0)}`},slider:{start:0,end:1,formatter:o=>x(o).format("YYYY-MM-DD")},meta:{tvl:{alias:"TVL(M)",min:0,max:c*1.1}}}).render(),()=>{l.current&&(l.current.innerHTML="")}},[r]),e.jsx(g,{title:"TVL(M)",bordered:!0,extra:e.jsxs(b,{children:[e.jsx(T,{type:"secondary",children:"Now "}),e.jsxs(T,{children:[Number(a/1e6).toFixed(2),"M"]}),e.jsx(T,{type:"secondary",children:"24h "}),e.jsx(T,{type:t.includes("-")?"danger":"success",children:t}),e.jsx(A,{type:"primary",onClick:s,children:"Refresh"})]}),children:e.jsx("div",{ref:l,style:{height:500}})})},re=({data:r})=>{const a=n.useRef(null);return n.useEffect(()=>{if(r.length!==0)return a.current&&new V(a.current,{data:r,xField:"tvl",yField:"name",yAxis:{label:{formatter:s=>`${s}`}},label:{position:"right",formatter:s=>`${s.tvl.toFixed(2)}`},meta:{tvl:{alias:"TVL(M)",max:Math.max(...r.map(s=>s.tvl))*1.1}}}).render(),()=>{a.current&&(a.current.innerHTML="")}},[r]),e.jsx(g,{title:"Top 30 TVL(M)",children:e.jsx("div",{ref:a,style:{height:500}})})},ae=async()=>{const r="https://api.llama.fi/protocols",a=await k.get(r);let t=[];return a.data.forEach(s=>{s.chains.includes("zkSync Era")&&s.category!=="CEX"&&t.push({name:s.name,tvl:s.chainTvls["zkSync Era"]/1e6})}),t.sort((s,l)=>l.tvl-s.tvl),t=t.slice(0,30),t},se=()=>{const[r,a]=n.useState([]),[t,s]=n.useState(null),[l,i]=n.useState(null),[c,u]=n.useState([]),[o,d]=n.useState(!1),[f,y]=n.useState(null),m=async()=>{d(!0);try{const h=await ee();a(h);const D=(h[h.length-1].tvl-h[h.length-2].tvl)/h[h.length-2].tvl*100;s(`${D.toFixed(2)}%`),i(h[h.length-1].tvl);const p=await ae();u(p)}catch(h){console.error("Failed to fetch data: ",h),y("Failed to fetch data.")}d(!1)};return n.useEffect(()=>{m()},[]),f?e.jsxs("div",{children:["Error: ",f]}):e.jsx("div",{children:e.jsx(M,{spinning:o,children:e.jsxs(S,{gutter:16,style:{marginTop:20},children:[e.jsx(v,{xs:24,md:12,children:r.length!==0&&e.jsx(te,{data:r,nowTvl:l,change24h:t,onRefresh:m})}),e.jsx(v,{xs:24,md:12,children:c.length!==0&&e.jsx(re,{data:c})})]})})})},ie=()=>{const r=[{label:"个人地址详情",key:"ZksyncMyAddress",children:e.jsx(J,{})},{label:"zkSync Tvl",key:"ZksyncTvl",children:e.jsx(se,{})},{label:"zkSync Bridge",key:"ZksyncBridge",children:e.jsx(W,{})},{label:"zkSync Vol",key:"ZksyncVol",children:e.jsx(q,{})}];return e.jsx(e.Fragment,{children:e.jsx(Z,{defaultActiveKey:"ZksyncTvl",centered:!0,items:r})})};export{ie as default};
